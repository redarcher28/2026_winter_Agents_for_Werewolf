# 狼人杀多Agent系统实验 - 10天冲刺计划

# 狼人杀多Agent系统实验 - 10人团队分工方案

## 一、团队结构与分工总览

我们10人团队分为3个小组，每组3-4人，设小组长负责协调。我兼任大组长和第一小组组长。

### 团队组织结构：
- **大组长**：我（兼任第一小组组长）
- **第一小组 (4人)**：法官系统组
- **第二小组 (3人)**：AI Agent框架组
- **第三小组 (3人)**：策略与集成组

## 二、各小组详细分工与个人任务

### 第一小组：法官系统组 (4人)

**小组目标**：构建稳定、高效、安全的法官系统，作为游戏的中枢控制系统。

**模块分解与分工**：

| 组员角色 | 具体模块 | 主要职责 | 需要学习的技术栈 |
|---------|---------|---------|-----------------|
| **小组长(大组长)** | **整体架构**<br>**状态管理** | 1. 设计法官系统整体架构<br>2. 实现核心GameState类<br>3. 定义游戏状态数据结构<br>4. 协调各模块接口对接 | **核心**：Python、UML设计、数据结构<br>**深入**：状态机设计模式、序列化/反序列化<br>**工具**：Git项目管理、团队协作工具 |
| **组员A** | **流程控制**<br>**主循环引擎** | 1. 实现回合阶段状态机<br>2. 编写游戏主循环逻辑<br>3. 处理阶段转换规则<br>4. 实现超时处理机制 | **核心**：Python、状态机实现<br>**深入**：异步编程(asyncio)、事件驱动编程<br>**工具**：Python调试器(pdb)、日志分析 |
| **组员B** | **权限与通信路由**<br>**API接口** | 1. 设计AgentContext数据结构<br>2. 实现信息过滤函数<br>3. 构建法官API服务器<br>4. 设计通信协议 | **核心**：FastAPI/Flask、Pydantic<br>**深入**：REST API设计、WebSocket<br>**安全**：信息权限验证、输入验证 |
| **组员C** | **日志与持久化**<br>**复盘系统** | 1. 设计结构化日志格式<br>2. 实现游戏状态持久化<br>3. 开发复盘查看功能<br>4. 性能监控与优化 | **核心**：SQLAlchemy、SQLite/PostgreSQL<br>**深入**：数据库设计、JSON序列化<br>**工具**：数据库管理工具、性能分析器 |

**小组内部协作方式**：
1. 每周两次小组会议（周一、周四）
2. 使用Git分支：judge-main、judge-state、judge-flow、judge-api、judge-db
3. 接口定义后需要小组内部评审通过
4. 单元测试覆盖率要求>80%

---

### 第二小组：AI Agent框架组 (3人)

**小组目标**：构建可复用的AI Agent基类框架，包括记忆管理、LLM调用、通信客户端等基础设施。

**模块分解与分工**：

| 组员角色 | 具体模块 | 主要职责 | 需要学习的技术栈 |
|---------|---------|---------|-----------------|
| **小组长** | **Agent基类**<br>**整体框架** | 1. 设计Agent通用基类<br>2. 定义Agent生命周期<br>3. 实现决策主循环<br>4. 协调模块集成 | **核心**：Python、面向对象设计<br>**深入**：设计模式(模板方法、策略模式)<br>**架构**：多智能体系统基础理论 |
| **组员D** | **记忆模块**<br>**上下文管理** | 1. 设计记忆存储结构<br>2. 实现记忆增删改查<br>3. 集成向量数据库<br>4. 上下文窗口管理 | **核心**：Python数据结构<br>**深入**：ChromaDB/FAISS向量数据库<br>**算法**：记忆检索与摘要算法<br>**工具**：向量数据库部署与调优 |
| **组员E** | **LLM调用层**<br>**输出解析** | 1. 封装LLM API调用<br>2. 实现输出结构化解析<br>3. 设计提示词模板引擎<br>4. 错误处理与重试机制 | **核心**：OpenAI/Anthropic API<br>**深入**：提示词工程原理<br>**工具**：JSON Schema验证<br>**优化**：API成本控制、缓存机制 |

**小组内部协作方式**：
1. 每周两次小组会议（周二、周五）
2. 使用Git分支：agent-main、agent-base、agent-memory、agent-llm
3. 建立Agent组件接口文档
4. 编写Agent框架使用示例和教程
5. 性能基准测试要求

---

### 第三小组：策略与集成组 (3人)

**小组目标**：实现各角色具体策略，进行系统集成、测试和优化。

**模块分解与分工**：

| 组员角色 | 具体模块 | 主要职责 | 需要学习的技术栈 |
|---------|---------|---------|-----------------|
| **小组长** | **狼人策略**<br>**对抗策略** | 1. 实现狼人Agent核心策略<br>2. 设计伪装与协作机制<br>3. 优化反预言家策略<br>4. 领导策略组工作 | **核心**：高级提示词工程<br>**深入**：博弈论基础、欺骗检测<br>**分析**：行为模式分析<br>**工具**：提示词A/B测试方法 |
| **组员F** | **神职策略**<br>**(预言家+女巫)** | 1. 实现预言家验人策略<br>2. 实现女巫用药策略<br>3. 设计身份暴露管理<br>4. 优化信息验证逻辑 | **核心**：逻辑推理链设计<br>**深入**：贝叶斯推理应用<br>**策略**：风险决策模型<br>**工具**：决策树分析工具 |
| **组员G** | **村民策略**<br>**集成与测试** | 1. 实现村民推理策略<br>2. 进行端到端系统集成<br>3. 编写测试用例<br>4. 性能监控与分析 | **核心**：Python测试框架(pytest)<br>**深入**：集成测试方法<br>**工具**：自动化测试框架<br>**分析**：游戏数据统计分析 |

**小组内部协作方式**：
1. 每周两次小组会议（周三、周六）
2. 使用Git分支：strategy-main、strategy-wolf、strategy-seer、strategy-villager
3. 建立策略评估指标体系
4. 定期进行策略对决测试
5. 编写策略调优指南


### 5. 学习资源共享
**共享知识库**：
1. **基础教程**：Python、FastAPI、LLM API使用
2. **设计模式**：状态机、策略模式、模板方法
3. **游戏理论**：狼人杀策略、博弈论基础
4. **工具指南**：Git协作、单元测试、性能分析


### 项目现状分析
**时间约束**：10天完成全AI狼人杀多Agent系统
**团队规模**：10人，分3个小组
**核心目标**：在极短时间内交付可运行、可演示的完整系统

### 策略调整
1. **功能优先级**：核心流程 > 策略复杂性 > 界面美化
2. **技术简化**：使用成熟库，避免重复造轮子
3. **增量交付**：每天都有可运行的版本
4. **并行开发**：最大化并行度，减少依赖阻塞

## 二、10天冲刺时间表

### Day 1-2：基础框架搭建
| 时间 | 小组 | 核心任务 | 交付物 |
|------|------|---------|-------|
| **Day 1上午** | 全体 | 项目启动会，技术栈确定，环境配置 | 统一的开发环境，Git仓库 |
| **Day 1下午** | 第一组 | 法官系统：基础状态管理，玩家数据结构 | GameState类v0.1 |
| **Day 1下午** | 第二组 | Agent框架：基础Agent类，API调用封装 | Agent基类v0.1 |
| **Day 1下午** | 第三组 | 策略：设计提示词模板，收集测试用例 | 策略模板v0.1，测试用例集 |
| **Day 2全天** | 第一组 | 法官：核心状态机，游戏主循环 | 可运行的单回合演示 |
| **Day 2全天** | 第二组 | Agent：记忆模块简化版，消息处理 | 能接收/发送消息的Agent |
| **Day 2全天** | 第三组 | 策略：基础角色策略（文本文件版） | 4个角色的基础提示词 |

### Day 3-4：核心流程开发
| 时间 | 小组 | 核心任务 | 交付物 |
|------|------|---------|-------|
| **Day 3上午** | 第一组 | 法官：信息权限过滤，通信接口 | 信息过滤函数，API端点 |
| **Day 3下午** | 第一组 + 第二组 | 接口对接：法官↔Agent基础通信 | 第一个端到端消息传递 |
| **Day 3全天** | 第三组 | 策略：完善提示词，添加few-shot示例 | 优化的策略提示词 |
| **Day 4全天** | 第一组 | 法官：完整回合循环（夜晚→白天→投票） | 完整的回合状态机 |
| **Day 4全天** | 第二组 | Agent：实现所有Agent类型，处理不同消息 | 狼人/预言家/女巫/村民Agent |
| **Day 4下午** | 第三组 | 策略：集成到Agent框架 | Agent能使用策略生成决策 |

### Day 5-6：集成与调试
| 时间 | 小组 | 核心任务 | 交付物 |
|------|------|---------|-------|
| **Day 5上午** | 全体 | 第一次完整集成测试 | 发现并记录主要问题 |
| **Day 5下午** | 各小组 | 根据测试结果修复问题 | Bug修复版本 |
| **Day 6上午** | 第一组 | 法官：添加日志和错误处理 | 稳定的法官系统 |
| **Day 6下午** | 第二组 | Agent：添加超时处理和重试机制 | 健壮的Agent框架 |
| **Day 6全天** | 第三组 | 策略：基于测试结果调整提示词 | 策略优化v1.0 |

### Day 7-8：策略优化与测试
| 时间 | 小组 | 核心任务 | 交付物 |
|------|------|---------|-------|
| **Day 7全天** | 第三组 | 深度策略调优，添加角色特定逻辑 | 高级策略提示词 |
| **Day 7全天** | 第一组 | 法官：添加简单的Web界面/命令行展示 | 可视化游戏进程 |
| **Day 7下午** | 第二组 | Agent：性能优化，响应时间控制 | 快速响应的Agent |
| **Day 8全天** | 全体 | 多轮完整对局测试 | 稳定运行3回合的系统 |
| **Day 8晚上** | 全体 | 验收标准检查 | 确认达成基本要求 |

### Day 9-10：收尾与演示准备
| 时间 | 小组 | 核心任务 | 交付物 |
|------|------|---------|-------|
| **Day 9上午** | 第一组 | 法官：最终bug修复，添加简单复盘功能 | 最终版法官系统 |
| **Day 9下午** | 第二组 | Agent：代码清理，文档注释 | 整洁的Agent框架 |
| **Day 9全天** | 第三组 | 策略：整理最佳实践，准备演示用例 | 演示用策略集 |
| **Day 10上午** | 全体 | 最终集成测试，演示彩排 | 完全可演示的系统 |
| **Day 10下午** | 全体 | 项目演示，总结汇报 | 最终项目交付 |

## 三、紧急调整的技术方案

### 1. 技术栈简化
| 组件 | 原方案 | 紧急方案 | 理由 |
|------|-------|---------|------|
| **法官API** | FastAPI + WebSocket | **Flask + HTTP** | 更简单，学习成本低 |
| **数据库** | PostgreSQL + SQLAlchemy | **JSON文件存储** | 避免数据库部署复杂度 |
| **记忆模块** | 向量数据库(Chroma) | **Python列表缓存** | 简化实现，后期可升级 |
| **LLM API** | 多厂商支持 | **仅OpenAI GPT-3.5/4** | 统一接口，减少适配工作 |
| **部署** | Docker容器化 | **直接Python运行** | 快速部署，便于调试 |

### 2. 代码结构
```
werewolf_ai/
├── game_master.py          # 法官主程序（第一组）
├── agent_base.py           # Agent基类（第二组）
├── strategies/             # 策略目录（第三组）
│   ├── werewolf_prompt.txt
│   ├── seer_prompt.txt
│   ├── witch_prompt.txt
│   └── villager_prompt.txt
├── config.py              # 配置文件
├── run_game.py            # 游戏启动脚本
├── logs/                  # 日志目录
├── game_state.json        # 游戏状态存储
└── requirements.txt       # 依赖包
```

### 3. 核心依赖（最小集）
```txt
# requirements.txt
openai>=1.0.0      # LLM调用
flask>=2.0.0       # Web框架
requests>=2.28.0   # HTTP客户端
python-dotenv      # 环境变量管理
```

## 四、详细分工与每日任务

### 第一小组：法官系统组（4人）
**目标**：3天内完成可运行法官系统，5天内完成集成

| 成员 | Day 1-2 | Day 3-4 | Day 5-6 | Day 7-8 | Day 9-10 |
|------|---------|---------|---------|---------|----------|
| **大组长** | 1. GameState设计<br>2. 协调会议 | 1. 状态机完善<br>2. 接口对接 | 1. 集成测试<br>2. Bug修复 | 1. Web界面<br>2. 性能监控 | 1. 最终测试<br>2. 演示准备 |
| **组员A** | 1. 玩家数据结构<br>2. 回合管理 | 1. 投票逻辑<br>2. 死亡处理 | 1. 错误处理<br>2. 日志系统 | 1. 界面开发<br>2. 用户交互 | 1. 代码整理<br>2. 文档编写 |
| **组员B** | 1. 信息权限表<br>2. 过滤函数 | 1. Flask API开发<br>2. 路由设计 | 1. API测试<br>2. 安全验证 | 1. 界面后端<br>2. 数据展示 | 1. 部署脚本<br>2. 环境配置 |
| **组员C** | 1. 事件记录<br>2. 历史管理 | 1. JSON存储<br>2. 状态持久化 | 1. 性能优化<br>2. 缓存机制 | 1. 复盘功能<br>2. 数据导出 | 1. 最终优化<br>2. 演示数据 |

### 第二小组：AI Agent框架组（3人）
**目标**：2天内完成基础框架，4天内完成所有Agent类型

| 成员 | Day 1-2 | Day 3-4 | Day 5-6 | Day 7-8 | Day 9-10 |
|------|---------|---------|---------|---------|----------|
| **小组长** | 1. Agent基类<br>2. 消息处理 | 1. 角色Agent类<br>2. 接口对接 | 1. 超时处理<br>2. 错误恢复 | 1. 性能优化<br>2. 并发处理 | 1. 代码清理<br>2. API文档 |
| **组员D** | 1. 记忆缓存<br>2. 上下文管理 | 1. 记忆持久化<br>2. 摘要生成 | 1. 记忆优化<br>2. 性能测试 | 1. 高级记忆<br>2. 智能检索 | 1. 记忆模块文档<br>2. 使用示例 |
| **组员E** | 1. OpenAI封装<br>2. 提示词渲染 | 1. 输出解析<br>2. JSON验证 | 1. 重试机制<br>2. 降级处理 | 1. 缓存实现<br>2. 成本控制 | 1. LLM模块文档<br>2. 配置指南 |

### 第三小组：策略与集成组（3人）
**目标**：每天迭代提示词，5天内完成稳定策略

| 成员 | Day 1-2 | Day 3-4 | Day 5-6 | Day 7-8 | Day 9-10 |
|------|---------|---------|---------|---------|----------|
| **小组长** | 1. 狼人策略设计<br>2. 测试用例 | 1. 策略集成<br>2. 效果评估 | 1. 深度调优<br>2. 对抗测试 | 1. 高级策略<br>2. 博弈分析 | 1. 最佳策略<br>2. 演示用例 |
| **组员F** | 1. 预言家策略<br>2. 女巫策略 | 1. 神职优化<br>2. 用药逻辑 | 1. 验证测试<br>2. 策略调整 | 1. 复杂场景<br>2. 协作策略 | 1. 策略文档<br>2. 调优指南 |
| **组员G** | 1. 村民策略<br>2. 推理逻辑 | 1. 集成测试<br>2. Bug报告 | 1. 系统测试<br>2. 性能测试 | 1. 压力测试<br>2. 稳定性 | 1. 测试报告<br>2. 演示准备 |

## 五、每日站会与检查点

### 每日例行（早9:00-9:20）
1. **昨日进展**（每人1分钟）
2. **今日计划**（每人1分钟）
3. **阻塞问题**（即时解决或会后处理）

### 关键检查点
| 时间 | 检查内容 | 负责人 |
|------|---------|-------|
| **Day 2晚** | 基础框架可运行演示 | 大组长 |
| **Day 4晚** | 完整单回合游戏演示 | 第一小组长 |
| **Day 6晚** | 多回合稳定运行演示 | 第二小组长 |
| **Day 8晚** | 3回合完整游戏通过 | 第三小组长 |
| **Day 10上午** | 最终演示彩排 | 全体 |

### 紧急沟通机制
1. **即时通讯**：建立紧急问题群，5分钟内响应
2. **结对编程**：复杂问题即时结对解决
3. **代码评审**：每日合并前简单评审
4. **知识共享**：每日晚分享关键学习

## 六、风险管理与应急预案

### 技术风险
| 风险 | 概率 | 影响 | 应对措施 | 负责人 |
|------|------|------|---------|-------|
| LLM API不稳定 | 高 | 高 | 1. 本地Mock备用<br>2. 降低调用频率<br>3. 使用缓存响应 | 组员E |
| 法官状态不一致 | 中 | 高 | 1. 增加状态检查点<br>2. 定期持久化<br>3. 添加状态验证 | 组员A |
| Agent响应超时 | 高 | 中 | 1. 设置超时限制<br>2. 添加默认行为<br>3. 异步处理 | 第二小组长 |
| 策略效果差 | 中 | 中 | 1. 准备多套策略<br>2. 人工编写示例<br>3. 简化游戏复杂度 | 第三小组长 |

### 进度风险
| 风险 | 迹象 | 应对措施 | 触发时间 |
|------|------|---------|---------|
| 接口对接延迟 | Day 3未完成消息传递 | 使用Mock接口继续开发 | Day 3晚 |
| 策略无效 | Day 5策略导致游戏卡住 | 使用规则引擎备用策略 | Day 5晚 |
| 性能问题 | Day 7单回合超过5分钟 | 简化逻辑，降低LLM调用 | Day 7早 |
| 集成失败 | Day 8无法完整运行 | 回退到上一个稳定版本 | Day 8中 |

## 七、交付物清单

### 核心代码（必须完成）
1. `game_master.py` - 完整的法官系统
2. `agent_base.py` - 可扩展的Agent框架
3. `strategies/` - 4个角色的有效策略
4. `run_game.py` - 一键启动脚本
5. `requirements.txt` - 完整的依赖列表

### 演示材料（必须完成）
1. **5分钟演示视频**：展示3回合完整游戏
2. **系统架构图**：展示核心模块与数据流
3. **角色策略示例**：展示AI的推理过程
4. **运行指南**：1页纸的快速启动说明

### 文档（尽力完成）
1. **设计文档**：核心架构与接口说明
2. **API文档**：法官与Agent的交互协议
3. **策略文档**：各角色提示词设计思路
4. **测试报告**：稳定性与性能测试结果

## 八、成功标准

### 最低可行产品（MVP）标准
1. ✅ 6个AI Agent参与游戏
2. ✅ 完整运行3个游戏回合
3. ✅ 正确判定游戏胜负
4. ✅ 角色行为基本合理（不暴露身份）
5. ✅ 10分钟内完成一局游戏

### 良好标准
1. ✅ 游戏流程稳定无崩溃
2. ✅ AI策略有明显差异（狼人伪装、预言家带队）
3. ✅ 支持简单复盘功能
4. ✅ 有基础的可视化展示
5. ✅ 代码结构清晰可扩展


## 九、10天详细任务清单

### Day 1任务清单
**第一组**：
- [ ] 创建GameState类（玩家列表、回合数、阶段）
- [ ] 实现玩家基本数据结构（ID、角色、状态）
- [ ] 编写基础的状态更新方法

**第二组**：
- [ ] 创建Agent基类（名称、角色、记忆）
- [ ] 实现OpenAI API调用封装
- [ ] 设计消息接收/发送接口

**第三组**：
- [ ] 设计4个角色的基础提示词模板
- [ ] 收集狼人杀基础术语和常见策略
- [ ] 创建测试用例文档

### Day 2任务清单
**第一组**：
- [ ] 实现游戏主循环（while循环）
- [ ] 添加基本的阶段转换逻辑
- [ ] 创建简单的命令行演示

**第二组**：
- [ ] 实现记忆模块（Python列表）
- [ ] 添加Agent工厂方法（创建不同角色）
- [ ] 测试Agent与Mock法官通信

**第三组**：
- [ ] 完善提示词，添加few-shot示例
- [ ] 测试提示词效果（人工评估）
- [ ] 创建策略评估标准

### Day 3任务清单
**第一组**：
- [ ] 实现信息权限过滤函数
- [ ] 创建Flask API服务器（3个端点）
- [ ] 设计AgentContext数据结构

**第二组**：
- [ ] 实现具体的角色Agent类
- [ ] 处理不同类型的请求（发言、投票、行动）
- [ ] 与真实法官API对接测试

**第三组**：
- [ ] 将提示词集成到Agent中
- [ ] 运行第一次端到端测试
- [ ] 记录策略问题并调整

### Day 4任务清单
**第一组**：
- [ ] 完整实现夜晚阶段（狼人杀人、预言家验人、女巫用药）
- [ ] 完整实现白天阶段（发言、投票）
- [ ] 添加游戏结束条件判断

**第二组**：
- [ ] 实现所有Agent类型（狼人×2、预言家、女巫、村民×2）
- [ ] 添加Agent配置管理
- [ ] 优化消息处理性能

**第三组**：
- [ ] 基于测试结果调整所有策略
- [ ] 添加角色特定的决策逻辑
- [ ] 创建策略版本管理

### Day 5任务清单
**全体**：
- [ ] 第一次完整集成测试
- [ ] 记录所有Bug和问题
- [ ] 分配Bug修复任务

### Day 6任务清单
**第一组**：
- [ ] 修复法官系统Bug
- [ ] 添加详细日志记录
- [ ] 实现游戏状态持久化（JSON）

**第二组**：
- [ ] 添加Agent超时处理
- [ ] 实现API调用重试机制
- [ ] 优化错误处理

**第三组**：
- [ ] 基于测试数据优化策略
- [ ] 添加异常情况处理
- [ ] 创建策略A/B测试框架

### Day 7任务清单
**第一组**：
- [ ] 添加简单的Web界面
- [ ] 实现游戏进度可视化
- [ ] 添加用户控制界面（开始/暂停/重放）

**第二组**：
- [ ] 性能优化：减少LLM调用次数
- [ ] 添加响应缓存机制
- [ ] 实现并发处理（可选）

**第三组**：
- [ ] 深度策略调优
- [ ] 添加高级游戏策略
- [ ] 创建策略效果评估报告

### Day 8任务清单
**全体**：
- [ ] 多轮完整对局测试（至少5局）
- [ ] 检查验收标准达成情况
- [ ] 修复剩余问题

### Day 9任务清单
**全体**：
- [ ] 最终代码清理和优化
- [ ] 编写用户文档和API文档
- [ ] 准备演示用例和脚本

### Day 10任务清单
**全体**：
- [ ] 最终演示彩排
- [ ] 录制演示视频
- [ ] 项目总结与汇报

## 十、快速开始指南（简化版）

### 环境准备（Day 1上午完成）
```bash
# 1. 安装Python 3.8+
python --version

# 2. 克隆代码库
git clone <repository-url>
cd werewolf_ai

# 3. 安装依赖
pip install -r requirements.txt

# 4. 配置OpenAI API密钥
echo "OPENAI_API_KEY=your_key_here" > .env
```

### 运行游戏（Day 4起可用）
```bash
# 简单运行（命令行）
python run_game.py

# 带界面运行（Day 7起）
python run_game.py --web

# 查看帮助
python run_game.py --help
```



---
**文档版本**：V3.0 (10天冲刺版)
**创建日期**：2026年01月10日