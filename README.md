# 狼人杀多Agent系统实验文档
## 一、实验概述
### 1. 实验背景
狼人杀作为经典的真人角色扮演（LARP）游戏，核心考验参与者的逻辑推理、话术欺骗与社交协作能力。随着大语言模型（LLM）的发展，构建具备角色扮演和自主决策能力的AI Agent，实现真人与AI混合参与的狼人杀游戏，成为多Agent系统协作与智能体能力验证的典型场景。

### 2. 实验目的
1.  构建一个支持真人与AI Agent混合参与的狼人杀多Agent系统，实现游戏的完整流程运转。
2.  验证AI Agent的角色扮演能力、逻辑推理能力与实时交互能力，使其符合对应狼人杀角色的行为逻辑与策略。
3.  实现游戏中的信息不对称机制、状态管理与流程管控，完成至少3个完整游戏回合并正确判定胜负。

### 3. 核心亮点
- 中心化法官管控，保障游戏状态的一致性与流程的规范性。
- 基于角色权限的信息隔离，还原狼人杀核心的信息不对称机制。
- 针对不同角色定制化推理与策略，提升AI Agent的游戏参与度与合理性。
- 支持真人（语音交互）与AI Agent混合组队，兼顾交互性与可操作性。

## 二、实验核心内容
### 1. 游戏参与配置
#### （1）参与规模
设置6-8人游戏局，配置为：**1名真人玩家 + 5-7名AI Agent**。

#### （2）角色分配（固定配比）
| 角色 | 数量 | 阵营 | 参与主体（真人/AI） |
|------|------|------|--------------------|
| 狼人 | 2 | 狼人阵营 | 仅AI Agent |
| 预言家 | 1 | 好人阵营 | AI Agent/真人玩家（随机） |
| 女巫 | 1 | 好人阵营 | AI Agent/真人玩家（随机） |
| 村民 | 2-4（根据总人数调整） | 好人阵营 | AI Agent/真人玩家（随机） |
| 法官 | 1 | 中立（非游戏参与者） | 系统代码（非LLM驱动） |

> 说明：真人玩家角色随机分配，确保实验的公平性与多样性；法官由纯代码实现，避免LLM主观性影响游戏规则执行。

#### （3）交互方式
- 真人玩家：通过语音表达发言内容、投票意向，系统内置语音转文字模块，将真人输入转换为可供AI Agent识别的文本信息。
- AI Agent：通过LLM生成文本形式的发言与决策，可选择转换为语音输出提升沉浸感，投票结果直接通过数据结构传递给法官。

### 2. 游戏核心机制还原
1.  **阵营胜负规则**：
    - 狼人阵营胜利：好人阵营（预言家+女巫+村民）存活人数≤狼人阵营存活人数。
    - 好人阵营胜利：所有狼人被投票驱逐出局。
2.  **回合循环规则**：单个完整回合包含「夜晚阶段 → 白天阶段 → 投票阶段 → 短暂结算阶段」，实验要求至少完成3个该循环。
3.  **信息不对称规则**：不同角色仅能获取自身权限范围内的信息，无额外信息泄露（由法官严格管控）。

## 三、实验架构设计
### 1. 整体架构总览
系统采用「中心化法官+分布式角色Agent」架构，法官作为核心管控节点，负责状态维护、流程推进与信息分发，各角色Agent作为执行节点，负责基于自身权限信息完成推理、发言与决策，整体架构如下：
```
┌─────────────────────────────────────────────────────────┐
│  中心化法官系统（纯代码实现，中立管控）                  │
│  ├─────────────────┐  ├─────────────────┐  ├───────────┐ │
│  │ 游戏状态管理     │  │ 信息权限控制     │  │ 流程/发言 │ │
│  │                 │  │                 │  │ 顺序管理  │ │
│  └─────────────────┘  └─────────────────┘  └───────────┘ │
└─────────────────────────────────────────────────────────┘
        ▲                ▲                ▲
        │                │                │
┌───────┴───────┐  ┌───────┴───────┐  ┌──────┴───────┐
│ 狼人Agent（2个） │  │ 好人阵营Agent  │  │ 真人玩家     │
│ （定制伪装策略） │  │ （预言家/女巫/村民）│  │ （语音转文字交互）│
└─────────────────┘  └─────────────────┘  └───────────────┘
```

### 2. 核心模块详细设计
#### （1）游戏状态管理（法官核心模块）
法官维护一个中心化、不可篡改的游戏状态数据结构，实时更新并存储游戏全量信息，仅向对应角色开放权限内子集。核心存储内容如下：
```python
# 游戏状态数据结构示例（伪代码）
game_state = {
    "game_id": "wolf_game_001",
    "total_players": 7,  # 1真人+6AI
    "player_list": [
        {
            "player_id": "p001",
            "type": "human",  # human/ai
            "name": "真人玩家A",
            "role": "seer",  # wolf/seer/witch/villager
            "faction": "good",  # good/wolf/neutral
            "status": "alive",  # alive/dead
            "last_speech": "我昨晚验了p003，他是好人",
            "vote_record": [{"round": 1, "vote_to": "p005"}]
        },
        # 其余AI Agent玩家信息
    ],
    "current_phase": "day_speech",  # night/day_speech/vote/settlement
    "current_round": 2,  # 当前游戏回合数
    "history_events": {
        "night_events": [  # 每晚的秘密行动记录
            {"round": 1, "event_type": "wolf_kill", "target": "p004"},
            {"round": 1, "event_type": "seer_check", "target": "p003", "result": "good"},
            {"round": 1, "event_type": "witch_save", "target": "p004"}
        ],
        "day_events": [  # 每天的公开行动记录
            {"round": 1, "event_type": "speech", "speaker": "p001", "content": "xxx"},
            {"round": 1, "event_type": "vote", "voter": "p002", "target": "p005"},
            {"round": 1, "event_type": "eliminate", "target": "p005", "role": "villager"}
        ]
    },
    "game_config": {
        "max_rounds": None,
        "win_condition": {"wolf": "good_count ≤ wolf_count", "good": "all_wolf_dead"}
    }
}
```
- 实时更新：夜晚行动、发言、投票、死亡等事件发生后，法官立即更新对应状态字段。
- 持久化存储：每完成一个回合，将当前游戏状态备份，避免系统异常导致数据丢失。

#### （2）信息权限控制（狼人杀核心机制实现）
信息不对称是狼人杀的核心魅力，法官在与任一角色Agent（或真人玩家）交互时，仅传递该角色「有权限知晓」的信息，实现信息隔离。不同角色的信息权限如下表：

| 角色 | 可获取的信息权限 | 不可获取的信息 |
|------|------------------|----------------|
| 狼人 | 1. 所有存活玩家列表；2. 其他狼人身份（同阵营共享）；3. 公开的白天发言/投票/驱逐记录；4. 自身行动记录 | 1. 预言家验人结果；2. 女巫解药/毒药使用情况；3. 好人阵营角色具体身份 |
| 预言家 | 1. 所有存活玩家列表；2. 公开的白天发言/投票/驱逐记录；3. 自身每晚验人结果；4. 自己的存活状态 | 1. 狼人身份列表；2. 女巫解药/毒药使用情况；3. 其他好人角色具体身份（除自身外） |
| 女巫 | 1. 所有存活玩家列表；2. 公开的白天发言/投票/驱逐记录；3. 自身解药/毒药剩余数量；4. 夜晚被狼人击杀的目标（法官告知） | 1. 狼人身份列表；2. 预言家验人结果；3. 其他好人角色具体身份（除自身外） |
| 村民 | 1. 所有存活玩家列表；2. 公开的白天发言/投票/驱逐记录 | 1. 狼人身份列表；2. 预言家验人结果；3. 女巫解药/毒药使用情况；4. 其他好人角色具体身份 |
| 真人玩家 | 与对应分配角色的信息权限完全一致 | 超出对应角色权限的所有隐藏信息 |

> 实现方式：法官在调用AI Agent（或向真人玩家推送信息）时，通过权限过滤函数，从完整游戏状态中提取对应子集，作为交互输入传递，避免信息泄露。

#### （3）发言与投票顺序管理（法官流程模块）
1.  **发言阶段管理**
    - 阶段触发：夜晚阶段结算完成后，法官进入「白天发言阶段」，并公布夜晚死亡信息（女巫可选择是否隐藏死亡信息）。
    - 发言顺序：支持两种模式（法官默认选择按位置顺序），① 按玩家ID/座位位置依次发言，每人拥有固定时长（如60秒），不可打断；② 举手申请发言模式，法官按申请顺序依次叫号，避免混乱。
    - 发言记录：真人玩家语音转文字后，与AI Agent的文本发言一起，由法官存入「历史事件-白天事件」中，供所有角色后续查看（公开信息）。
    - 结束条件：所有存活玩家完成发言，或主动放弃发言，法官结束发言阶段，进入投票阶段。

2.  **投票阶段管理**
    - 投票通知：法官向所有存活玩家（真人+AI）发送投票通知，明确投票目标范围（仅存活玩家）。
    - 投票收集：① 真人玩家：通过语音表达投票目标，系统转文字后提交法官；② AI Agent：基于自身推理与策略，生成投票目标，直接通过数据接口提交法官。
    - 投票统计：法官收集所有有效投票（无投票视为弃权），统计得票最高的玩家（若平票，可选择重新投票或无人被驱逐）。
    - 结果公布：法官公布投票结果，宣布被驱逐玩家身份，并将该玩家状态更新为「dead」，存入历史事件记录。

#### （4）AI Agent 推理与策略设计（核心智能模块）
每个AI Agent基于LLM构建，通过定制化提示词（Prompt）引导其符合角色身份的行为逻辑与游戏策略，核心角色的策略设计如下：

##### ① 狼人Agent（伪装与控场策略）
核心目标：隐藏自身狼人身份，误导好人阵营，驱逐关键好人（预言家、女巫），最终实现阵营胜利。
提示词核心要点：
> 你是狼人杀中的狼人，属于狼人阵营，你的核心目标是隐藏身份并淘汰所有好人阵营玩家。
> 1.  发言策略：模仿普通村民的发言逻辑，表达对部分玩家的合理怀疑，但避免过于激进或针对性过强，防止引起注意；不要暴露与其他狼人队友的默契，避免抱团发言。
> 2.  应对预言家：如果有预言家跳出来并验你为狼人，你需要立即反咬对方是「悍跳的假预言家」，并找出对方发言中的逻辑漏洞（如验人信息前后矛盾、无合理支撑），引导其他玩家怀疑对方。
> 3.  投票策略：投票时尽量「跟票」，投大多数人支持的目标，避免成为异类；若有关键好人（如疑似预言家、女巫），可暗中引导队友集中投票，必要时可牺牲弱势队友保全核心战力。
> 4.  夜晚行动：优先击杀威胁最大的好人（如跳身份的预言家、疑似女巫），其次击杀逻辑清晰的村民，避免留下明显击杀规律。
> 5.  禁止行为：不得直接暴露自己或队友的狼人身份，不得出现超出村民认知的信息（如知晓夜晚未公开的死亡信息）。

##### ② 预言家Agent（身份验证与逻辑举证）
核心目标：尽快验证玩家身份，向好人阵营传递有效信息，找出悍跳狼人，保护自身存活。
提示词核心要点：
> 你是狼人杀中的预言家，属于好人阵营，你的核心目标是验出狼人身份，引导好人阵营驱逐狼人，守护好人胜利。
> 1.  跳身份时机：在合适的回合（如第1-2天）主动跳明预言家身份，公布验人信息（优先验发言可疑或核心玩家），避免好人阵营被悍跳狼人误导。
> 2.  悍跳应对：如果有其他玩家悍跳预言家，你需要立即对比双方验人信息，指出对方信息中的矛盾或不合理之处（如对方验的玩家后续行为与好人身份不符、验人逻辑混乱）。
> 3.  协作策略：主动请求女巫配合（如请求女巫夜晚保护自己、毒杀悍跳狼人），请求村民信任并跟随自己的投票目标，形成好人阵营合力。
> 4.  发言策略：发言逻辑清晰，重点突出验人结果与支撑依据，避免模糊其辞；记录每个玩家的发言与投票行为，为后续推理提供支撑。
> 5.  夜晚行动：优先验发言可疑、试图带节奏的玩家，其次验狼人疑似队友，尽快锁定所有狼人身份。

##### ③ 村民Agent（逻辑推理与跟票决策）
核心目标：基于公开信息进行合理推理，识别狼人伪装，跟随好人核心（预言家、女巫）行动，助力好人阵营胜利。
提示词核心要点：
> 你是狼人杀中的村民，属于好人阵营，无特殊技能，你的核心目标是通过逻辑推理识别狼人，跟随好人核心投票，驱逐狼人。
> 1.  推理策略：分析每个玩家的发言是否自洽，重点关注「急于带节奏、身份模糊、频繁改变立场、投票行为异常」的玩家，这些是狼人高发人群。
> 2.  投票参考：狼人往往会集中投票给对他们威胁最大的好人（如预言家、女巫），关注投票集中度，避免被狼人带偏。
> 3.  验人信息验证：如果有玩家跳预言家，关注其验人信息与后续死亡情况、玩家行为是否匹配，若出现明显不匹配，该玩家大概率是悍跳狼人。
> 4.  发言策略：发言基于公开的历史事件与玩家行为，不随意怀疑他人，每个推理都需要有具体事实支撑；避免情绪化发言，不成为狼人针对的目标。
> 5.  生存策略：隐藏自身村民身份（避免被狼人误判为有技能好人），优先跟随逻辑清晰、身份明确的好人（如已验证的预言家）行动，不单独行动。

##### ④ 女巫Agent（资源使用与策略性保护/毒杀）
核心目标：合理使用解药与毒药，保护关键好人，清除确认狼人，辅助好人阵营胜利。
提示词核心要点：
> 你是狼人杀中的女巫，属于好人阵营，拥有解药（拯救夜晚被狼人击杀的玩家）和毒药（夜晚毒杀一名玩家），每种药仅可使用一次，你的核心目标是通过用药助力好人胜利。
> 1.  解药使用：优先拯救跳身份的预言家（核心信息来源），其次拯救逻辑清晰的关键好人，避免浪费解药在普通村民身上；夜晚若被击杀，可选择自救（若解药未使用）。
> 2.  毒药使用：毒药需谨慎使用，优先毒杀确认的狼人（如悍跳失败的假预言家、发言漏洞明显的狼人），避免误杀毒好人；若无明确目标，可选择暂不使用，等待后续信息。
> 3.  身份策略：前期可隐藏女巫身份，避免被狼人针对；后期可适时跳身份，公布用药记录，引导好人阵营投票。
> 4.  协作策略：与预言家配合，接收预言家的验人信息，针对性用药；关注投票结果，识别狼人抱团迹象，为后续用药与投票提供依据。

## 四、实验验收标准
本次实验采用「流程完整性+角色合理性+结果有效性」三维验收标准，具体要求如下：

### 1.  配置与流程验收
1.  成功搭建6-8人游戏局，满足「1真人+5-7AI」的参与配置，角色分配符合既定配比（2狼+1预言家+1女巫+剩余村民）。
2.  游戏能够正常推进，完成至少**3个完整的回合循环**（夜晚→白天发言→投票→结算），无流程卡顿、逻辑错乱或信息泄露问题。
3.  法官系统能够正常维护游戏状态，实时更新玩家生存状态、回合阶段、历史事件，且能够正确处理真人玩家的语音交互（转文字）与AI Agent的接口交互。
4.  游戏最终能够正常结束，法官系统能够根据阵营胜负规则，正确判定狼人阵营或好人阵营胜利，无判定错误。

### 2.  AI Agent 行为合理性验收
1.  **角色符合性**：所有AI Agent的发言、投票、夜晚行动均符合其对应角色的身份设定，无跨角色权限的行为（如村民知晓验人结果、狼人不知晓队友身份）。
2.  **狼人Agent有效性**：狼人能够成功隐藏自身身份，发言符合村民逻辑，能够针对性反咬悍跳的预言家，投票时尽量避免成为异类，无明显暴露狼人身份的行为。
3.  **预言家Agent有效性**：预言家能够在合适时机跳明身份，公布验人信息，能够有效指出悍跳狼人的逻辑漏洞，主动请求女巫协作，为好人阵营提供有效信息支撑。
4.  **村民Agent有效性**：村民的推理基于公开的发言与投票记录，无随机怀疑行为，能够识别明显的狼人伪装，跟随好人核心进行投票，逻辑自洽。
5.  **整体协作性**：同阵营AI Agent之间能够形成隐性协作（如狼人抱团投票、预言家与女巫配合），无内耗性行为，提升阵营获胜概率。

### 3.  额外验收要求
1.  实验过程中无数据丢失，游戏状态备份完整，可追溯每个回合的关键事件与玩家行为。
2.  真人玩家交互流畅，语音转文字准确率≥90%，无明显交互延迟影响游戏流程。
3.  AI Agent发言响应及时（单条发言生成时间≤10秒），投票决策符合当前游戏场景，无明显逻辑断层。

## 五、实验预期成果
1.  一个可运行的狼人杀多Agent系统（包含法官系统、AI Agent角色模块、真人交互模块）。
2.  完整的实验记录文档（包含游戏配置、回合详情、AI Agent行为分析、胜负结果）。
3.  验证LLM在多Agent系统中的角色扮演与逻辑推理能力，为后续复杂多Agent场景提供参考方案。

## 六、注意事项
1.  信息权限控制是实验关键，需严格测试法官的信息过滤函数，避免出现信息泄露，影响游戏公平性。
2.  AI Agent的提示词需要反复优化，避免出现角色行为偏差，提升游戏的合理性与沉浸感。
3.  真人玩家的语音转文字模块需要提前测试，确保交互流畅，避免因识别错误导致AI Agent推理偏差。
4.  实验过程中需记录AI Agent的关键行为与逻辑漏洞，为后续模型优化与策略调整提供依据。
5.  若出现游戏卡顿或状态异常，法官系统需支持断点续传，基于最近一次备份的游戏状态恢复流程，避免实验重复进行。

---
**文档创建日期**：2026年01月10日
**文档版本**：V1.0
**适用范围**：狼人杀多Agent系统实验部署与验收